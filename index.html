<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Star Notary</title>
        <link rel="stylesheet" type="text/css" href="style.css">

        <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
    </head>

    <body>
        <div class="container">
            <h1>Create Star </h1>

            <div class="row">
                <label class="bold">Star Id:</label>
                <input type="text" id="id" value="" placeholder="number">
            </div>
            
            <div class="row">
                <label class="bold">Star Name:</label>
                <input type="text" id="name" value="" placeholder="text">
            </div>

            <div class="row">
                <label class="bold">Star story:</label>
                <input type="text" id="story" value="" placeholder="text">
            </div>

            <div class="row">
                <label class="bold">Star RA:</label>
                <input type="text" id="ra" value="" placeholder="number">
            </div>

            <div class="row">
                <label class="bold">Star DEC:</label>
                <input type="text" id="dec" value="" placeholder="number">
            </div>

            <div class="row">
                <label class="bold">Star MAG:</label>
                <input type="text" id="mag" value="" placeholder="number">
            </div>

            <button id="create-button" onclick="createStarFromInput()">Create Star</button>

            <!-- <button id="claim-button" onclick="claimButtonClicked()">Claim Star</button> -->
        </div>

        <div class="container-2">
                <h1>Get Star</h1>
    
                
                <div class="row">
                    <label class="bold">Star Id:</label>
                    <input type="text" id="tokenId" value="" placeholder="id">
                </div>
    
                <button id="getStar-button" onclick="getStar()">Get Star</button>

                <div class="row">
                    <label class="bold">Star Name:</label>
                    <label id="star-name"></label>
                </div>

                <div class="row">
                    <label class="bold">Star Story:</label>
                    <label id="star-story"></label>
                </div>
                <div class="row">
                    <label class="bold">Star coordenate:</label>
                    <label id="star-coord"></label>
                </div>
    
                <!-- <button id="claim-button" onclick="claimButtonClicked()">Claim Star</button> -->
            </div>

        <script>    
         
            if(typeof web3 != 'undefined') { 
                web3 = new Web3(web3.currentProvider) // what Metamask injected 
            } else {
                // Instantiate and set Infura as your provider
                web3 = new Web3(new Web3.providers.HttpProvider("https://rinkeby.infura.io/v3/79c3f13d9cf5449ab1d020895bd09420"));
            }

            // The default (top) wallet account from a list of test accounts 
            web3.eth.defaultAccount = web3.eth.accounts[0];

            // The interface definition for your smart contract (the ABI) 
            var StarNotary = web3.eth.contract(
                [
                    {
                    "constant": true,
                    "inputs": [
                        {
                        "name": "interfaceId",
                        "type": "bytes4"
                        }
                    ],
                    "name": "supportsInterface",
                    "outputs": [
                        {
                        "name": "",
                        "type": "bool"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "constant": true,
                    "inputs": [
                        {
                        "name": "",
                        "type": "uint256"
                        }
                    ],
                    "name": "starsForSale",
                    "outputs": [
                        {
                        "name": "",
                        "type": "uint256"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "constant": true,
                    "inputs": [
                        {
                        "name": "tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "getApproved",
                    "outputs": [
                        {
                        "name": "",
                        "type": "address"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "constant": false,
                    "inputs": [
                        {
                        "name": "to",
                        "type": "address"
                        },
                        {
                        "name": "tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "approve",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                    },
                    {
                    "constant": true,
                    "inputs": [
                        {
                        "name": "",
                        "type": "uint256"
                        }
                    ],
                    "name": "tokenIdToStarInfo",
                    "outputs": [
                        {
                        "name": "name",
                        "type": "string"
                        },
                        {
                        "name": "starStory",
                        "type": "string"
                        },
                        {
                        "name": "ra",
                        "type": "string"
                        },
                        {
                        "name": "dec",
                        "type": "string"
                        },
                        {
                        "name": "mag",
                        "type": "string"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "constant": false,
                    "inputs": [
                        {
                        "name": "from",
                        "type": "address"
                        },
                        {
                        "name": "to",
                        "type": "address"
                        },
                        {
                        "name": "tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "transferFrom",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                    },
                    {
                    "constant": true,
                    "inputs": [
                        {
                        "name": "",
                        "type": "bytes32"
                        }
                    ],
                    "name": "uniqueness",
                    "outputs": [
                        {
                        "name": "",
                        "type": "bytes32"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "constant": false,
                    "inputs": [
                        {
                        "name": "from",
                        "type": "address"
                        },
                        {
                        "name": "to",
                        "type": "address"
                        },
                        {
                        "name": "tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "safeTransferFrom",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                    },
                    {
                    "constant": true,
                    "inputs": [],
                    "name": "minted",
                    "outputs": [
                        {
                        "name": "",
                        "type": "uint256"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "constant": true,
                    "inputs": [
                        {
                        "name": "tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "ownerOf",
                    "outputs": [
                        {
                        "name": "",
                        "type": "address"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "constant": true,
                    "inputs": [
                        {
                        "name": "owner",
                        "type": "address"
                        }
                    ],
                    "name": "balanceOf",
                    "outputs": [
                        {
                        "name": "",
                        "type": "uint256"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "constant": false,
                    "inputs": [
                        {
                        "name": "to",
                        "type": "address"
                        },
                        {
                        "name": "approved",
                        "type": "bool"
                        }
                    ],
                    "name": "setApprovalForAll",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                    },
                    {
                    "constant": false,
                    "inputs": [
                        {
                        "name": "from",
                        "type": "address"
                        },
                        {
                        "name": "to",
                        "type": "address"
                        },
                        {
                        "name": "tokenId",
                        "type": "uint256"
                        },
                        {
                        "name": "_data",
                        "type": "bytes"
                        }
                    ],
                    "name": "safeTransferFrom",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                    },
                    {
                    "constant": true,
                    "inputs": [
                        {
                        "name": "owner",
                        "type": "address"
                        },
                        {
                        "name": "operator",
                        "type": "address"
                        }
                    ],
                    "name": "isApprovedForAll",
                    "outputs": [
                        {
                        "name": "",
                        "type": "bool"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                    },
                    {
                    "anonymous": false,
                    "inputs": [
                        {
                        "indexed": false,
                        "name": "error",
                        "type": "string"
                        }
                    ],
                    "name": "validation",
                    "type": "event"
                    },
                    {
                    "anonymous": false,
                    "inputs": [
                        {
                        "indexed": false,
                        "name": "minted",
                        "type": "uint256"
                        }
                    ],
                    "name": "mintedToken",
                    "type": "event"
                    },
                    {
                    "anonymous": false,
                    "inputs": [
                        {
                        "indexed": true,
                        "name": "from",
                        "type": "address"
                        },
                        {
                        "indexed": true,
                        "name": "to",
                        "type": "address"
                        },
                        {
                        "indexed": true,
                        "name": "tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "Transfer",
                    "type": "event"
                    },
                    {
                    "anonymous": false,
                    "inputs": [
                        {
                        "indexed": true,
                        "name": "owner",
                        "type": "address"
                        },
                        {
                        "indexed": true,
                        "name": "approved",
                        "type": "address"
                        },
                        {
                        "indexed": true,
                        "name": "tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "Approval",
                    "type": "event"
                    },
                    {
                    "anonymous": false,
                    "inputs": [
                        {
                        "indexed": true,
                        "name": "owner",
                        "type": "address"
                        },
                        {
                        "indexed": true,
                        "name": "operator",
                        "type": "address"
                        },
                        {
                        "indexed": false,
                        "name": "approved",
                        "type": "bool"
                        }
                    ],
                    "name": "ApprovalForAll",
                    "type": "event"
                    },
                    {
                    "constant": false,
                    "inputs": [
                        {
                        "name": "_name",
                        "type": "string"
                        },
                        {
                        "name": "_starStory",
                        "type": "string"
                        },
                        {
                        "name": "_ra",
                        "type": "string"
                        },
                        {
                        "name": "_dec",
                        "type": "string"
                        },
                        {
                        "name": "_mag",
                        "type": "string"
                        },
                        {
                        "name": "_tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "createStar",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                    },
                    {
                    "constant": false,
                    "inputs": [
                        {
                        "name": "_tokenId",
                        "type": "uint256"
                        },
                        {
                        "name": "_price",
                        "type": "uint256"
                        }
                    ],
                    "name": "putStarUpForSale",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                    },
                    {
                    "constant": false,
                    "inputs": [
                        {
                        "name": "_tokenId",
                        "type": "uint256"
                        }
                    ],
                    "name": "buyStar",
                    "outputs": [],
                    "payable": true,
                    "stateMutability": "payable",
                    "type": "function"
                    }
                ]
            );
            // Grab the contract at specified deployed address with the interface defined by the ABI
            var starNotary = StarNotary.at('0x9d7b818b378857157071a7c9eb3c757ba5dd0ab3');
            
            // Create a new star            
            function createStarFromInput(){

                var name = document.getElementById("name").value
                var story = document.getElementById("story").value
                var ra = document.getElementById("ra").value
                var dec = document.getElementById("dec").value
                var mag = document.getElementById("mag").value
                var id = parseInt(document.getElementById("id").value,10)

                web3.eth.getAccounts(function(error, accounts) { 
                        if (error) { 
                            console.log(error)
                            return
                        }
                        var account = accounts[0]
                        starNotary.createStar(name,story,ra,dec,mag,id,{from: account},function (error, result) {
                            if (!error) {
                                //location.reload();
                                alert("Created!");
                            } else { 
                                //console.log(error);
                                alert("Error!");
                            }
                        });
                })

                document.getElementById("name").value = "";
                document.getElementById("story").value = "";
                document.getElementById("ra").value = "";
                document.getElementById("dec").value = "";
                document.getElementById("mag").value = "";
                document.getElementById("id").value = "";
            }

            // get star from Rinkeby Network
            function getStar(){
                var id = document.getElementById("tokenId").value;

                starNotary.tokenIdToStarInfo(id,function(error, result){
                    if (!error) {
                        document.getElementById('star-name').innerText = result[0]
                        document.getElementById('star-story').innerText = result[1]
                        var coord = "ra: "+result[2]+" dec: "+result[3]+" mag: "+result[4]
                        document.getElementById('star-coord').innerText = coord

                    } else { 
                        console.log(error);
                    }
                });  
            }
        </script>
    </body>
</html>